
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>PuPlasAn (Pulsed Plasma Analyser) &#8212; PuPlasAn 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="puplasan" href="modules.html" />
    <link rel="prev" title="Welcome to PuPlasAn’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="puplasan-pulsed-plasma-analyser">
<h1>PuPlasAn (Pulsed Plasma Analyser)<a class="headerlink" href="#puplasan-pulsed-plasma-analyser" title="Permalink to this headline">¶</a></h1>
<p>The program is responsible for a complete numerical analysis of pulsed plasma spectra, i. e. filtering (<em>filters.py</em>), estimating noise level (<em>noise.py</em>) and spectral baseline (<em>bline.py</em>), and detecting spectral lines and/or bands (<em>pdetect.py</em>). The peaks detected may then undergo deterministic or stochastic numerical fitting of line or band profiles (<em>pfit.py</em>). Optical depth and spectral line broadening issues may be dealt with by using <em>broad.py</em>.</p>
<p>Next, several procedures based on applying the Boltzmann law can be used to evaluate plasma distribution temperature(s) with <em>bolplot.py</em>. Spectroscopic diagnostics of the transitions observed may be defined ad hoc or using a class <em>pbase.py</em>.
Based on similar relations and approaches, <em>abund.py</em> performs stepwise elemental and speciation analyses of an LTE pulsed plasma. Alternatively, such properties may be extracted from a solution to radiative transfer equations (<em>rte.py</em>).</p>
<p>Finally, <em>rate.py</em> and <em>mechanism.py</em> calculate reaction rate coefficients based on user-defined data (<em>rdbase.csv</em> with a ReadMe file) and cover simpler kinetic modelling of the plasma systems investigated with time-resolved spectroscopic methods.</p>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1">#example.py</span>
<span class="c1">#Vojtěch Laitl et all at J. Heyrovsky Institute</span>
<span class="c1">#of Physical Chemistry, CAS,</span>
<span class="c1">#Czech Republic, 2022</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">assig_database</span><span class="p">(</span><span class="n">species</span><span class="p">,</span><span class="n">lines</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">aij</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">eu</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">gu</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">species</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">species</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">en</span> <span class="o">=</span> <span class="n">species</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">species</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">mu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">aij</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">eu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">en</span><span class="p">)</span>
        <span class="n">gu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mu</span><span class="p">,</span><span class="n">aij</span><span class="p">,</span><span class="n">eu</span><span class="p">,</span><span class="n">gu</span>

<span class="k">def</span> <span class="nf">assig_peak</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span><span class="n">lines</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">a0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a0</span>

<span class="c1">#customised functions translating database inputs</span>

<span class="k">def</span> <span class="nf">gauss</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">):</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">fwhm</span><span class="o">/</span><span class="mf">2.35482</span>
    <span class="k">return</span> <span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span> <span class="o">*</span>
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">wl</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">a</span>


<span class="k">def</span> <span class="nf">lorentz</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">):</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">fwhm</span><span class="o">/</span><span class="mf">2.</span>
    <span class="k">return</span> <span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">0.5</span><span class="o">*</span><span class="n">gamma</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">wl</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
            <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">*</span> <span class="n">a</span>


<span class="k">def</span> <span class="nf">pseudovoigt</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">lorentz</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">fwhm</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">g</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">l</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span>

<span class="k">def</span> <span class="nf">fitpeak</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">checkplot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">pseudovoigt</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span>
                           <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span><span class="n">maxfev</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">checkplot</span><span class="p">:</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="s1">&#39;b.-&#39;</span><span class="p">)</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">profiles</span><span class="p">[</span><span class="n">profile</span><span class="p">](</span><span class="n">wl</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">pl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pcov</span><span class="p">)</span>
    <span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span><span class="p">,</span> <span class="n">perr</span>

<span class="c1">#basic line profile functions to be fitted</span>

<span class="k">def</span> <span class="nf">sw</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">a0</span><span class="o">+</span><span class="n">a1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="n">a2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#computation of Stark widths using fitting constants</span>
<span class="c1">#stored in Stark-B database http://stark-b.obspm.fr/</span>

<span class="c1">#assuming the program is stored in a preceding</span>
<span class="n">puplasan_path</span> <span class="o">=</span> <span class="s1">&#39;../&#39;</span>
<span class="c1">#directory (as copied from GitHub) -- to be changed accordingly</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">puplasan_path</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="s1">&#39;Xe_spectrum.dpt&#39;</span> <span class="c1">#spectral sample to be evaluated</span>

<span class="kn">import</span> <span class="nn">puplasan</span>
<span class="kn">import</span> <span class="nn">puplasan.pfit</span> <span class="k">as</span> <span class="nn">pf</span>
<span class="kn">import</span> <span class="nn">puplasan.bolplot</span> <span class="k">as</span> <span class="nn">bp</span>
<span class="kn">import</span> <span class="nn">puplasan.noise</span> <span class="k">as</span> <span class="nn">ns</span>
<span class="kn">import</span> <span class="nn">puplasan.bline</span> <span class="k">as</span> <span class="nn">bl</span>
<span class="kn">import</span> <span class="nn">puplasan.pbase</span> <span class="k">as</span> <span class="nn">pb</span>
<span class="kn">import</span> <span class="nn">puplasan.pdetect</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">puplasan.abund</span> <span class="k">as</span> <span class="nn">ab</span>
<span class="kn">import</span> <span class="nn">puplasan.assign</span> <span class="k">as</span> <span class="nn">assig</span>
<span class="kn">import</span> <span class="nn">puplasan.broad</span> <span class="k">as</span> <span class="nn">sbm</span>

<span class="c1">#Welcome to the program &quot;puplasan&quot; made</span>
<span class="c1">#by Vojtěch Laitl et all</span>
<span class="c1">#at J. Heyrovsky Institute of Physical Chemistry,</span>
<span class="c1">#CAS, Czech Republic, 2020.</span>
<span class="c1">#Below you can find an example program script.</span>

<span class="c1">#The script guides you through an example evaluation</span>
<span class="c1">#of an emission UV-ViS LIBS plasma spectrum</span>
<span class="c1">#(LIPS of Xe+H2 1:1 mol. gas)</span>
<span class="c1">#The lines below are responsible for loading a spectrum file,</span>
<span class="c1">#its fitting, and elemental and physical characterisitcs.</span>

<span class="n">XeI_lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;Xe_I_lines.dat&#39;</span><span class="p">)</span>
<span class="n">XeII_lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;Xe_II_lines.dat&#39;</span><span class="p">)</span>

<span class="c1">#loads a translated database input from the NIST database</span>
<span class="c1">#https://www.nist.gov/pml/atomic-spectra-database</span>
<span class="c1">#(transition probabilities against wavelength)</span>

<span class="n">lines_all</span> <span class="o">=</span> <span class="p">[</span>
<span class="n">XeI_lines</span><span class="p">,</span>
<span class="n">XeII_lines</span>
<span class="p">]</span>

<span class="n">spec</span> <span class="o">=</span> <span class="p">[</span>
<span class="s1">&#39;XeI&#39;</span><span class="p">,</span>
<span class="s1">&#39;XeII&#39;</span>
<span class="p">]</span>


<span class="n">spec_ne</span> <span class="o">=</span> <span class="p">[</span>
<span class="s1">&#39;XeI&#39;</span>
<span class="p">]</span>

<span class="n">g0_ne</span> <span class="o">=</span> <span class="p">[</span>
<span class="mf">1.</span>
<span class="p">]</span>

<span class="n">spec_ion</span> <span class="o">=</span> <span class="p">[</span>
<span class="s1">&#39;XeII&#39;</span>
<span class="p">]</span>

<span class="n">g0_ion</span> <span class="o">=</span> <span class="p">[</span>
<span class="mf">4.</span>
<span class="p">]</span>

<span class="c1">#defines a set of species involved, respectively comprising</span>
<span class="c1">#all species, excited neutrals, and ions</span>

<span class="c1">#gives degeneracies of 0-th energy levels correspoding</span>
<span class="c1">#to all species present (neutral atoms and ions separately)</span>

<span class="n">linelist</span> <span class="o">=</span> <span class="p">{</span><span class="n">spec</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">lines_all</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">))}</span>

<span class="c1">#species used to calculate electron number density</span>
<span class="n">spec_el_dens</span> <span class="o">=</span> <span class="s1">&#39;XeII&#39;</span>

<span class="c1">#species used as a reference for CF analysis</span>
<span class="n">spec_ref</span> <span class="o">=</span> <span class="s1">&#39;XeII&#39;</span>

<span class="n">stark_path</span> <span class="o">=</span> <span class="s1">&#39;stark_&#39;</span><span class="o">+</span><span class="n">spec_el_dens</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
<span class="n">stark_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">stark_path</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                          <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
<span class="n">wl_stark_ne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">stark_path</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                         <span class="n">usecols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span>
<span class="c1">#loads a translated database input from the Stark B database</span>
<span class="c1">#(temperature-dependent Stark widths against wavelength)</span>

<span class="n">width_stark_ne</span> <span class="o">=</span> <span class="n">sw</span><span class="p">(</span><span class="n">stark_params</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">stark_params</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">stark_params</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="mf">10000.</span><span class="p">)</span>
<span class="c1">#calculates Stark widths based on the database-defined</span>
<span class="c1">#formula (T=10000 K is a guessed value)</span>

<span class="n">spe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#loads a spectrum to be plotted</span>

<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\lambda$ (nm)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$I$ (arb. u.)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;spectrum.png&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">d_max</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#tolerance of peak assigning procedure</span>
<span class="n">fwhm0</span> <span class="o">=</span> <span class="mf">0.02355</span> <span class="c1">#FWHM estimate (nm)</span>

<span class="n">noise</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">noise_estim_ma_xdependent</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="mi">61</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">bl</span><span class="o">.</span><span class="n">base</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="mi">101</span><span class="p">,</span><span class="n">noise</span><span class="p">)</span>
<span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">b</span>
<span class="n">px</span><span class="p">,</span> <span class="n">py</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">3.</span><span class="o">*</span><span class="n">noise</span><span class="p">,</span>
                   <span class="mf">1.</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="n">fulloutput</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1">#estimates the noise level</span>
<span class="c1">#subtracts baseline signal</span>
<span class="c1">#detects spectral line peaks</span>

<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">px</span><span class="p">)):</span>

    <span class="n">pl</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">px</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">520</span><span class="p">,</span><span class="mi">550</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\lambda$ (nm)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$I$ (arb. u.)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;spectrum_analysed.png&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">fit_spect</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">peak_model</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="n">py</span><span class="p">,</span><span class="n">spe</span><span class="p">,</span><span class="s1">&#39;ifc&#39;</span><span class="p">)</span>
<span class="c1">#fits an example spectrum</span>

<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span>
        <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;experiment&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">fit_spect</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">fit_spect</span><span class="p">),</span>
        <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">520</span><span class="p">,</span> <span class="mi">550</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.1</span><span class="p">])</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\lambda$ (nm)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$I$ (arb. u.)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">pl</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;spectrum_compared.png&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">ne_</span> <span class="o">=</span> <span class="n">linelist</span><span class="p">[</span><span class="n">spec_el_dens</span><span class="p">]</span>
<span class="n">wl_ne</span> <span class="o">=</span> <span class="n">ne_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lines_ne</span> <span class="o">=</span> <span class="n">assig</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="n">wl_ne</span><span class="p">,</span><span class="n">d_max</span><span class="p">)</span>
<span class="n">mu_ne</span><span class="p">,</span><span class="n">aij_ne</span><span class="p">,</span> <span class="n">eu_ne</span><span class="p">,</span> <span class="n">gu_ne</span> <span class="o">=</span> <span class="n">assig_database</span><span class="p">(</span><span class="n">ne_</span><span class="p">,</span><span class="n">lines_ne</span><span class="p">)</span>
<span class="n">a_ne</span> <span class="o">=</span> <span class="n">assig_peak</span><span class="p">(</span><span class="n">py</span><span class="p">,</span><span class="n">lines_ne</span><span class="p">)</span>
<span class="c1">#assigns selected spectral lines</span>
<span class="c1">#to compute electron number density</span>


<span class="n">fw_ne</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mu_ne</span><span class="p">)):</span>

    <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="n">mu_ne</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">a_ne</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">fwhm0</span><span class="p">]</span>
    <span class="n">fitted_ne</span> <span class="o">=</span> <span class="n">fitpeak</span><span class="p">(</span><span class="n">spe</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">spe</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">p0</span><span class="p">)</span>
    <span class="n">fw</span> <span class="o">=</span> <span class="n">fitted_ne</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">fw_ne</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fw</span><span class="p">)</span>
<span class="c1">#pre-estimates the linewidth of selected spectral lines</span>

<span class="n">sigma_stark_ne</span> <span class="o">=</span> <span class="n">sbm</span><span class="o">.</span><span class="n">assign_stark</span><span class="p">(</span><span class="n">fw_ne</span><span class="p">,</span> <span class="n">wl_stark_ne</span><span class="p">,</span> <span class="n">mu_ne</span><span class="p">)</span>
<span class="n">fwhm_stark_ne</span> <span class="o">=</span> <span class="mf">2.355</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sigma_stark_ne</span><span class="p">)</span>
<span class="n">N_e</span><span class="p">,</span> <span class="n">N_e_stddev</span> <span class="o">=</span> <span class="n">sbm</span><span class="o">.</span><span class="n">stark2ne</span><span class="p">(</span><span class="n">fwhm_stark_ne</span><span class="p">,</span><span class="n">width_stark_ne</span><span class="p">)</span>
<span class="c1">#assigns the inspection spectral lines and calculates</span>
<span class="c1">#the electron density with uncertainty</span>

<span class="n">C_I</span><span class="p">,</span> <span class="n">C_I_stddev</span><span class="p">,</span> <span class="n">Q_I</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_ne</span><span class="p">)):</span>

    <span class="n">spec_</span> <span class="o">=</span> <span class="n">linelist</span><span class="p">[</span><span class="n">spec_ne</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
    <span class="n">gu_</span> <span class="o">=</span> <span class="n">spec_</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">eu_</span> <span class="o">=</span> <span class="n">spec_</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">spec_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">assig</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="n">wl</span><span class="p">,</span><span class="n">d_max</span><span class="p">)</span>

    <span class="n">mu</span><span class="p">,</span><span class="n">aij</span><span class="p">,</span> <span class="n">eu</span><span class="p">,</span> <span class="n">gu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">assig_database</span><span class="p">(</span><span class="n">spec_</span><span class="p">,</span><span class="n">lines</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">assig_peak</span><span class="p">(</span><span class="n">py</span><span class="p">,</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">logbp</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">logbp</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">aij</span><span class="p">,</span><span class="n">gu</span><span class="p">)</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">T_stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">eu</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">logbp</span><span class="p">)))</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">q_stddev</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">q</span><span class="p">(</span><span class="n">g0_ne</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">gu_</span><span class="p">,</span><span class="n">eu_</span><span class="p">,</span><span class="n">T</span><span class="p">,</span> <span class="n">T_stddev</span><span class="p">)</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">c_stddev</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">aij</span><span class="p">,</span><span class="n">gu</span><span class="p">,</span><span class="n">eu</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>

    <span class="n">Q_I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">C_I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">C_I_stddev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_stddev</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">C_II</span><span class="p">,</span> <span class="n">C_II_stddev</span><span class="p">,</span> <span class="n">Q_II</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_ion</span><span class="p">)):</span>

    <span class="n">spec_</span> <span class="o">=</span> <span class="n">linelist</span><span class="p">[</span><span class="n">spec_ion</span><span class="p">[</span><span class="n">l</span><span class="p">]]</span>
    <span class="n">gu_</span> <span class="o">=</span> <span class="n">spec_</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">eu_</span> <span class="o">=</span> <span class="n">spec_</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">spec_</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">assig</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="n">wl</span><span class="p">,</span><span class="n">d_max</span><span class="p">)</span>

    <span class="n">mu</span><span class="p">,</span><span class="n">aij</span><span class="p">,</span> <span class="n">eu</span><span class="p">,</span> <span class="n">gu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">assig_database</span><span class="p">(</span><span class="n">spec_</span><span class="p">,</span><span class="n">lines</span><span class="p">))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">assig_peak</span><span class="p">(</span><span class="n">py</span><span class="p">,</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">logbp</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">logbp</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">aij</span><span class="p">,</span><span class="n">gu</span><span class="p">)</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">T_stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">eu</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">logbp</span><span class="p">)))</span>
    <span class="n">q</span><span class="p">,</span> <span class="n">q_stddev</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">q</span><span class="p">(</span><span class="n">g0_ion</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">gu_</span><span class="p">,</span><span class="n">eu_</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">T_stddev</span><span class="p">)</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">c_stddev</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">c</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">aij</span><span class="p">,</span><span class="n">gu</span><span class="p">,</span><span class="n">eu</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>

    <span class="n">C_II</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">C_II_stddev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c_stddev</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Q_II</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

<span class="c1">#(pre-)estimates elemental abundances in terms</span>
<span class="c1">#of the Boltzmann plot method</span>
<span class="c1">#saves separate results for excited neutrals and ions</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">C_I</span><span class="p">,</span><span class="n">C_II</span><span class="p">])</span>
<span class="n">C_stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">C_I_stddev</span><span class="p">,</span> <span class="n">C_II_stddev</span><span class="p">])</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">Q_I</span><span class="p">,</span> <span class="n">Q_II</span><span class="p">])</span>

<span class="c1">#gives a list of unnormalised abundances</span>

<span class="n">ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span><span class="o">==</span><span class="n">spec_ref</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#indexes the abundance of a reference species</span>

<span class="n">C_norm</span><span class="p">,</span> <span class="n">C_stddev_norm</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec</span><span class="p">)):</span>

    <span class="n">C_norm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">/</span><span class="n">C</span><span class="p">[</span><span class="n">ref</span><span class="p">])</span>
    <span class="n">C_stddev_norm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">C_stddev</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span><span class="o">/</span><span class="n">C</span><span class="p">[</span><span class="n">ix</span><span class="p">]))</span>

<span class="c1">#normalises elemental abundances against given reference</span>

<span class="n">T_min</span> <span class="o">=</span> <span class="mf">5000.</span>
<span class="n">T_max</span> <span class="o">=</span> <span class="mf">30000.</span>

<span class="c1">#estimates bounds for temperature optimisation</span>

<span class="n">T</span><span class="p">,</span> <span class="n">T_stddev</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">temp</span><span class="p">(</span><span class="n">T_min</span><span class="p">,</span><span class="n">T_max</span><span class="p">,</span><span class="n">spec</span><span class="p">,</span><span class="n">lines_all</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="n">px</span><span class="p">,</span><span class="n">py</span><span class="p">)</span>

<span class="c1">#calculates the plasma thermodynamic temperature</span>
<span class="c1">#elemental abundances and electron density may be</span>
<span class="c1">#re-estimated iteratively with the plasma temperature</span>
<span class="c1">#known -- few iterations are usually needed</span>
</pre></div>
</div>
<p>Figures produced by the example code:</p>
<img alt="_images/spectrum.png" src="_images/spectrum.png" />
<img alt="_images/spectrum_analysed.png" src="_images/spectrum_analysed.png" />
<img alt="_images/spectrum_compared.png" src="_images/spectrum_compared.png" />
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PuPlasAn</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">PuPlasAn (Pulsed Plasma Analyser)</a><ul>
<li class="toctree-l2"><a class="current reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">puplasan</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to PuPlasAn’s documentation!</a></li>
      <li>Next: <a href="modules.html" title="next chapter">puplasan</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Vojtěch Laitl.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/ReadMe.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>
